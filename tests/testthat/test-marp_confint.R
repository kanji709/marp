test_that("marp_confint", {
  skip('skipping long tests')

  # (optional) load the small test dataset
  # data_file <- system.file("extdata", "small.txt", package = "marp", mustWork = TRUE)
  # data <- read.table(data_file)$V1

  # set some parameters
  m <- 10 # number of iterations for MLE optimization
  t <- seq(100,200,by=10) # time intervals
  y <- 304 # cut-off year for estimating probablity
  B <- 100 # number of bootstraps
  BB <- 100 # number of double bootstraps
  which.model <- 2 # specify the generating model

  # fix the random seed
  set.seed(42)

  # sample data for testing
  data <- rgamma(30, 3, 0.01)

  # fit renewal model
  suppressWarnings(  # suppressing warnings from stats::nlm: NA/Inf replaced by maximum positive value
    res <- marp::marp_confint(data,m,t,B,BB,alpha,y,which.model)
  )

  # check result
  expect_equal(res$out$par1, c(3.4136086430979953e-03, 2.7626793657057762e+00, 2.6037039674870583e+00, 3.3080162440951688e+02, 5.4882183788378658e+00, 2.9294512422957860e+02), tolerance = 1e-6)
  expect_equal(res$out$par2, c(NA, 9.4307059277139432e-03, 2.4759796859031687e+02, 1.8010183507666513e+00, 6.5084541680686814e-01, 7.1824719073918109e-01), tolerance = 1e-6)
  expect_equal(res$out$logL, c(-200.39955882401648, -193.76650950646049, -195.12976531758551, -193.92377676645586, -194.33021376270909, -194.40996001614093), tolerance = 1e-6)
  expect_equal(res$out$AIC, c(402.79911764803296, 391.53301901292099, 394.25953063517102, 391.84755353291172, 392.66042752541819, 392.81992003228186), tolerance = 1e-6)
  expect_equal(res$out$BIC, c(404.20031502969510, 394.33541377624528, 397.06192539849530, 394.64994829623600, 395.46282228874247, 395.62231479560614), tolerance = 1e-6)
  expect_equal(res$out$mu_hat, c(292.94512187913182, 292.94512912200048, 319.72017228620746, 294.16945213908519, 298.87285747700128, 292.94512422957860), tolerance = 1e-6)
  expect_equal(res$out$pr_hat, c(0.60038574701819891, 0.42154974433034809, 0.53433568234281148, 0.30779792692414687, 0.56416103510057725, 0.61794524610544410), tolerance = 1e-6)

  expect_true(all.equal(res$out$haz_hat,  c(
    -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -5.6799852941338829,
    -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -5.6799852941338829, -6.0942031084732298,
    -5.9967873794574516, -5.9117418563554684, -5.8368230853439300, -5.7703089176306639, -5.7108525626839901, -5.6573839062669986,
    -5.6090408956082456, -5.5651206740587922, -5.5250440506799734, -5.4883291920475745, -6.0990192429336094, -5.9701664705134210,
    -5.8576899644670348, -5.7593884711134971, -5.6734972529860741, -5.5985621349393231, -5.5333565788683616, -5.4768259914915305,
    -5.4280496904694857, -5.3862145095364315, -5.3505961502861927, -6.1714638710963881, -6.0951186680582552, -6.0254209583640863,
    -5.9613052806725335, -5.9019434350392981, -5.8466788789061646, -5.7949823391436279, -5.7464209045603756, -5.7006359661738628,
    -5.6573271297614109, -5.6162402596857071, -5.9235521978533958, -5.8023896004395645, -5.7047473880293342, -5.6252373537796752,
    -5.5599409055534252, -5.5059486025117375, -5.4610610586440487, -5.4235891601883868, -5.3922173604047572, -5.3659081375131672,
    -5.3438339586221275, -5.7911126719889303, -5.6765973314326752, -5.5892417143301261, -5.5216608261560411, -5.4687921205249133,
    -5.4270729562323066, -5.3939387902533049, -5.3675067327627373, -5.3463701567645607, -5.3294619641245422, -5.3159614865560094
  ), tolerance = 1e-6))

  expect_equal(res$percent_CI$weights_bstp, c(0.00000000000000000, 0.17999999999999999, 0.00000000000000000, 0.52000000000000002, 0.01000000000000000, 0.28999999999999998), tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_gen, 294.03991725708693, tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_gen_lower, 238.98074655648443, tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_gen_upper, 359.44706603915893, tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_best, 294.03991708496801, tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_best_lower, 239.39853692669547, tolerance = 1e-6)
  expect_equal(res$percent_CI$mu_best_upper, 359.61227984520303, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_gen, 0.42456149142094557, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_gen_lower, -0.26710327640775772, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_gen_upper, 0.99562914822446891, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_best, 0.37796032726203044, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_best_lower, -0.32898300523374208, tolerance = 1e-6)
  expect_equal(res$percent_CI$pr_best_upper, 0.97117904481959849, tolerance = 1e-6)
  expect_true(all.equal(res$percent_CI$haz_gen, c(-6.1195890465920177, -6.0102701147574251, -5.9267416226115985, -5.8571037379106086, -5.7929434883223552, -5.7340622955922349, -5.6710867633068132, -5.6242685233967400, -5.5742312527528641, -5.5337508197044194, -5.5040667250758322), tolerance = 1e-6))
  expect_true(all.equal(res$percent_CI$haz_gen_lower, c(-7.0498921110318422, -6.8718942817300119, -6.7161006033263657, -6.5786301717937894, -6.4564739160712588, -6.3472558103255725, -6.2490706293470968, -6.1603704632377818, -6.0798833391959457, -5.9990889646300616, -5.9248635757361541), tolerance = 1e-6))
  expect_true(all.equal(res$percent_CI$haz_gen_upper, c(-5.7088936369115855, -5.6277767967315429, -5.5418026153757882, -5.4681668994089669, -5.4023685967634041, -5.3462396686610081, -5.3005141731676719, -5.2593206966939636, -5.2220194432647071, -5.1880858574932827, -5.1570856716377049), tolerance = 1e-6))

  expect_equal(res$student_CI$mu_lower_gen, 240.20962250997357, tolerance = 1e-6)
  expect_equal(res$student_CI$mu_upper_gen, 365.17773170972157, tolerance = 1e-6)
  expect_equal(res$student_CI$pr_lower_gen, -0.13586173279097602, tolerance = 1e-6)
  expect_equal(res$student_CI$pr_upper_gen, 0.97065613799990513, tolerance = 1e-6)
  expect_equal(res$student_CI$mu_lower_ma, 238.3514720468213, tolerance = 1e-6)
  expect_equal(res$student_CI$mu_upper_ma, 403.83372319485505, tolerance = 1e-6)
  expect_equal(res$student_CI$pr_lower_ma, -0.16200208766248458, tolerance = 1e-6)
  expect_equal(res$student_CI$pr_upper_ma, 1.0881783950832409, tolerance = 1e-6)
  expect_true(all.equal(res$student_CI$haz_lower_ma, c(-6.6940930203514943, -6.5602089371231029, -6.4416921263026481, -6.3336934862789587, -6.2520605334519193, -6.1821667974078158, -6.1123753586852159, -6.0685776315384556, -6.0160054914027388, -5.9769364106068856, -5.9176011837813505), tolerance = 1e-6))
  expect_true(all.equal(res$student_CI$haz_upper_ma, c(-5.3453427195899126, -5.2774251683990352, -5.2526610375322491, -5.2304267365883010, -5.1843229024344692, -5.1694670265387028, -5.1351015563390803, -5.0953658859998594, -5.0718444519239254, -5.0501511147225875, -5.0272274857252528), tolerance = 1e-6))

  })

